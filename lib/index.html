<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Preview Icons</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <style>
      body {
        background-color: ghostwhite;
      }
      svg {
        fill: none;
        padding: 5px;
      }
    </style>

    <script>
      const configs = [
        "height: 1em;--svg-fg: black;--svg-ac: none;",
        "height: 2em;--svg-fg: gray;--svg-ac: #A01441;",
        "height: 2em;--svg-fg: gray;--svg-ac: #56A3BC;",
        "background-color: #A01441; height: 2em;--svg-fg: white;--svg-ac: none;",
        "background-color: #56A3BC; height: 2em;--svg-fg: white;--svg-ac: none;",
      ];

      var dynamic = {
        h: "1em",
        fg: "gray",
        bg: "white",
        ac: "none",
      };

      function readFile(file) {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.addEventListener("load", (file) =>
            resolve(file.target.result)
          );
          reader.addEventListener("error", reject);
          reader.readAsText(file);
        });
      }

      var count = 0;

      function draw() {
        if (!count) {
          return;
        }
        document.getElementById("output").innerHTML = [
          `background-color: ${dynamic.bg}; height: ${dynamic.h};--svg-fg: ${dynamic.fg};--svg-ac: ${dynamic.ac};`,
          ...configs,
        ]
          .map(
            (config) =>
              "<div>" +
              config +
              "<br/>" +
              Array.apply(0, Array(count))
                .map(
                  (_, index) =>
                    `<svg viewBox="0 0 100 100" style="${config}"><use xlink:href="#svg-${index}" /></svg>`
                )
                .join(" ") +
              "</div><br/><br/><br/>"
          )
          .join("");
      }

      async function onChange(event) {
        document.getElementById("loading").style.display = "initial";
        const files = await Promise.all([...event.target.files].map(readFile));
        const response = await fetch("/process", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(files),
        });
        const sprite = await response.text();
        document.getElementById("sprite").innerHTML = sprite;
        count = files.length;
        draw();
        document.getElementById("loading").style.display = "none";
      }
    </script>
  </head>
  <body>
    <p>
      You can preview Check-In icons using this page. First select one or more SVG files, and then you can change the size/colors. <br /> 
      After selecting the SVGs, please wait for about 5 seconds for the results to load. In case of problems, just refresh the page.
    </p>
    <div>
      <label>Select SVGs </label>
      <input onchange="onChange(event)" multiple type="file" accept=".svg" />
    </div>
    <h2 id="loading" style="display: none;">
      Loading...
    </h2>
    <div id="sprite" style="display: none"></div>
    <div>
      <label>Height</label>
      <input
        type="number"
        min="1"
        max="100"
        value="1"
        onchange="dynamic.h = event.target.value + 'em';draw()"
      />
      <br />
      <label>Background</label>
      <input
        type="color"
        value="#FFFFFF"
        onchange="dynamic.bg = event.target.value;draw()"
      />
      <br />
      <label>Foreground</label>
      <input
        type="color"
        value="#808080"
        onchange="dynamic.fg = event.target.value;draw()"
      />
      <br />
      <label>Accent</label>
      <input
        type="color"
        value="#000000"
        onchange="dynamic.ac = event.target.value;draw()"
      />
      <br />
    </div>
    <div id="output"></div>
  </body>
</html>
